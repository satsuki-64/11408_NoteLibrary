## 13.1 磁盘的结构
**磁盘**
- 磁盘：
	- 磁盘的表面由一些磁性物质组成，可以用这些磁性物质来记录二进制数据；
- 磁道与扇区：
	- 磁盘的盘面被划分成一个个磁道这样的一个“圈”就是一个磁道，一个磁道又被划分成一个个扇区，每个扇区就是一个“磁盘块”，各个扇区存放其的数据量相同；

**数据读取**
+ 概念：
	+ 需要把“磁头”移动到想要读/写的扇区所在的磁道； 
	+ 磁盘会转起来，让目标扇区从磁头下面划过，才能完成对扇区的读/写操作；

**盘面与柱面**
+ 盘面：
	+ 一个盘片可能会有两个盘面；
+ 磁头方向：
	+ 每个盘面对应一个磁头，所有的磁头都是连在同一个磁臂上的，因此所有磁头都只能是“共进退”；
+ 磁盘地址：
	+ 结构：
		+ $$(柱面号，盘面号，扇区号)$$ 
		+ 用此来定位任意一个“磁盘块”；
		+ 文件数据存放在外存中的几号块 `->` 这个块号就可以转换成 $(柱面号，盘面号，扇区号)$ 的地址形式；
+ 读取过程：
	+ 1. 根据“柱面号”移动磁臂，让磁头指向指定柱面;
	+ 2. 激活指定盘面对应的磁头；
	+ 3. 磁盘旋转的过程中，指定的扇区会从磁头下面划过，这样就完成了对指定扇区的读/写。
+ 图示：
	+ ![[Pasted image 20240409210854.png]]

**磁盘的分类**
- 磁头移动分类
	- 活动头磁盘：
		- 磁头可以移动的称为活动头磁盘；
		- 磁臂可以来回伸缩来带动磁头定位磁道；
	- 固定头磁盘：
		- 磁头不可以移动的称为固定头磁盘；
		- 这种磁盘中每个磁道有一个磁头；
- 盘片跟换分类
	- 可换盘磁盘：
		- 盘片可以更换的称为可换盘磁盘；
	- 固定盘磁盘：
		- 盘片不可更换的称为固定盘磁盘；

## 13.2 磁盘调度算法
### 13.2.1 读/写时间
![[Pasted image 20240409210948.png]]

### 13.2.2 FCFS
**先来先服务算法 (FCFS)**
- **思想**
	- 根据进程请求访问磁盘的先后顺序进行调度
- **特点**
	- `优点:`
		- **公平**
		- 如果请求访问的磁道比较集中的话，算法性能还算过的去
	- `缺点:`
		- 如果有大量进程竞争使用磁盘，请求访问的磁道很分散，则 FCFS 在性能上很差，寻道时间长
- 图示：
	- ![[Pasted image 20240409211047.png]]

### 13.2.3 SSTF
**最短寻找时间优先 (SSTF)**
- **思想**
	- SSTF 算法会优先处理的磁道是与当前磁头最近的磁道。
	- 可以保证每次的寻道时间最短，但是并不能保证总的寻道时间最短。(其实就是贪心算法的思想，只是选择眼前最优，但是总体未必最优)
- **特点**
	- `优点:`
		- 性能较好，平均寻道时间短
	- `缺点:`
		- 可能产生**饥饿**现象
			- 产生饥饿的原因在于：磁头在一个小区域内来回去地移动

### 13.2.4 SCAN
**扫描算法 (SCAN)**
- **思想**
	- [[#SSTF|SSTF]] 算法会产生饥饿，为了防止这个问题可以规定，只有磁头移动到最外侧磁道的时候才能往内移动，移动到最内侧磁道的时候才能往外移动。
	- 由于磁头移动的方式很像电梯，因此也叫电梯算法。
- **特点**
	- `优点:`
		- 性能较好，平均寻道时间较短，不会产生饥饿现象
	- `缺点:`
		1. 只有到达最边上的磁道时才能改变磁头移动方向
		2. SCAN 算法对于各个位置的磁道的响应频率不平均

### 13.2.5 LOOK
**LOOK 调度算法**
- **思想**
	- 扫描算法 ([[#SCAN|SCAN]])中，只有到大最边上的磁道时才能改变磁头移动方向
	- 解决：如果在磁头移动方向上已经没有别的请求，就可以立即改变磁头移动方向（边移动边观察，因此叫 LOOK）
- **特点**
	- `优点:`
		- 比起 SCAN 算法来，不需要每次都移动到最外侧或最内侧才改变磁头方向，使寻道时间进一步缩短。

### 13.2.6 C-SCAN
**循环扫描算法 (C-SCAN)**
- **思想**
	- 问题：
		- [[#SCAN|SCAN]] 算法对于各个位置磁道的响应频率不平均
	- 解决：
		- 规定只有磁头朝某个特定方向移动时才处理磁道访问请求，而返回时直接快速移动至起始端而不处理任何请求。
- **特点**
	- `优点:`
		- 比起 SCAN 来，对于各个位置磁道的响应频率很平均
	- `缺点:`
		- 只有到达最边上的磁道时才能改变磁头移动方向，事实上，处理了 184 号磁道的访问请求之后就不需要再往右移动磁头了
		- 并且，磁头返回时其实只需要返回到 18 号磁道即可，不需要返回到最边缘的磁道。
		- 另外，比起 SCAN 算法来，平均寻道时间更长。

### 13.2.7 C-LOOK
**C-LOOK 调度算法**
- **思想**
	- 问题：
		- C-SCAN 算法的主要缺点时只有到达最边上的磁道时才能改变磁头移动方向，并且磁头返回时不一定需要返回到最边缘的磁道上。
	- 解决：
		- 规定如果磁头移动的方向上已经没有磁道访问请求了，就可以立即让磁头返回，并且磁头只需要返回到有磁道访问请求的位置即可。
- **特点**
	- `优点:`
		- 比起 [[#C-SCAN|C-SCAN]] 算法来，不需要每次都移动到最外侧或最内侧才改变磁头方向，使寻道时间进一步缩短。

## 13.3 减少磁盘延迟时间的方法
### 13.3.1 交替编号
 **交替编号**
- **思想**
	- 若采用交替编号的策略，即让逻辑上相邻的扇区在物理上有一定的间隔，可以使读取连续的逻辑扇区所需要的延迟时间更小。

### 13.3.2 磁盘地址结构的设计
读取地址连续的磁盘块时，采用 (柱面号，盘面号，扇区号)的地址结构可以减少磁头移动消耗的时间。

## 13.4 磁盘的管理
### 13.4.1 初始化
**磁盘初始化**
- **step 1**
	- 进行低级格式化(物理格式化)，将磁盘的各个磁道划分为扇区。
		- 一个扇区通常可分为头，数据区域，尾 3 部分
		- 包括扇区校验码 (如[[2 - 1 - 4 奇偶校验码#奇偶校验|奇偶校验]]，[[2 - 1 - 6 循环冗余校验码#CRC码|CRC]] 循环冗余校验码等)
- **step 2**
	- 将磁盘分区，每个分区由若干柱面组成 (即分为我们熟悉的 C 盘，D 盘，E 盘)
- **step  3**
	- 进行逻辑格式化，创建文件系统。
		- 包括创建文件系统的根目录，初始化存储空间管理所用的数据结构 (如[[4 - 1 - 5 文件存储空间管理#^mk-202303191555|位示图]]，[[4 - 1 - 5 文件存储空间管理#^mk-202303191557|空闲分区表]])

### 13.4.2 引导块
**初始化程序**
- 计算机开机时需要进行一系列初始化的工作，这些初始化工作通过执行初始化程序(自举程序)完成的
- **存放位置**
	- 初始化程序可以放在 ROM (只读存储器)中。
		- ROM 中的数据在出厂时就写入了，并且以后不能再修改
		- 注意：ROM 一般时出厂时就集成在主板上的
- **现代计算机**
	- ROM 中只存放很小的**自举装入程序**
	- 开机时计算机先运行自举装入程序，通过执行改程序就可找到 `引导块`，并将完整的自举程序读入内存，完成初始化
- **启动块**
	- 完整的自举程序放在磁盘的启动块 (即引导/启动分区)上，启动位于磁盘的固定位置。
	- **注意**
		- 拥有启动分区的磁盘称为启动磁盘或系统磁盘(C: 盘)

### 13.4.3 坏块的管理
 **坏块**
- **定义**
	- 坏了，无法正常使用的扇区就是**坏块**。
	- 这属于硬件故障，操作系统是无法修复的。应该将坏块标记出来，以免错误地使用到它
- **解决**
	- **对于简单的磁盘**
		- 可以逻辑格式化时 (建立文件系统时)对整个磁盘进行坏块检查，表明哪些扇区是坏扇区
			- 比如：在 FAT 表上标明 (在这种方式中，坏块对操作系统不透明)
	- **对于复杂分磁盘**
		- 磁盘控制器 (磁盘设备内部的一个硬件部件)会维护一个坏块链表。
		- 在磁盘出厂前进行低级格式化 (物理格式化)时就将坏块链进行初始化。
		- 会保留一些**备用扇区**，用于替换坏块。
			- 这种方案称为扇区备用。
			- 且这种处理方式中，坏块对操作系统透明